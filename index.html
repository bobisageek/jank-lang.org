<!DOCTYPE html><meta charset="utf-8"><meta content="width=device-width,initial-scale=1"name="viewport"><link href="/img/favicon.svg"rel="icon"type="image/svg+xml"><link href="/css/main.css"rel="stylesheet"><link href="https://css.gg/css?=sync|bulb|list|link|git-fork|info|comment|math-minus|check-o|heart"rel="stylesheet"><title>jank programming language - Clojure/LLVM/Gradual Typing</title><link rel="preconnect"href="https://fonts.googleapis.com"><link rel="preconnect"href="https://fonts.gstatic.com"crossorigin><link href="https://fonts.googleapis.com/css2?family=Comfortaa"rel="stylesheet"><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var e="//matomo.jeaye.com/",a=(_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]),document),t=a.createElement("script"),a=a.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",a.parentNode.insertBefore(t,a)}()</script><noscript><p><img src="//matomo.jeaye.com/matomo.php?idsite=1&amp;rec=1"style="border:0"alt=""></p></noscript><div><div><nav class="navbar is-white"><div class="container"><div class="navbar-brand"><a class="navbar-item title"href="/"style="font-family:Comfortaa">jank</a></div><div class="navbar-menu"><div class="navbar-end has-text-weight-semibold"><a class="navbar-item"href="/progress"><span class="icon mr-1"><i class="gg-list"></i></span><strong>Progress</strong></a><a class="navbar-item"href="https://github.com/jeaye/jank"><span class="icon mr-1"><i class="gg-git-fork"></i></span><strong>Github</strong></a><a class="navbar-item"href="https://clojurians.slack.com/archives/C03SRH97FDK"><span class="icon mr-1"><i class="gg-comment"></i></span>Community</a></div></div></div></nav></div><section class="hero is-info"><div class="hero-body"><div class="container py-6"><div class="columns"><div class="column mt-6 is-offset-2 is-8"><p class="title">The jank programming language<p class="content is-size-5"><p class="content is-size-5"><div class="has-text-left"style="line-height:1.7em"><p>jank is a <strong>general-purpose programming language</strong> which embraces the <strong>interactive, value-oriented</strong> nature of Clojure as well as the desire for <strong>native compilation and minimal runtimes</strong>. jank is <strong>100% compatible with Clojure</strong>.</div><p><p class="content is-size-5"><div class="has-text-left"style="line-height:1.7em"><p>Where jank differs from Clojure is that its host is C++ on top of an <strong>LLVM-based JIT</strong>. Furthermore, jank has a built-in <strong>gradual type system</strong> which allows for malli-style type annotations which result in <strong>static type analysis</strong>. This allows jank to offer the same benefits of <strong>REPL-based development</strong> while being able to reach much further into the lands of both <strong>correctness and performance</strong>.</div><p><p class="content is-size-5"><div class="has-text-left"style="line-height:1.7em"><p>Still, jank is a Clojure dialect and thus includes its <strong>code-as-data philosophy and powerful macro system</strong>. jank remains a functional-first language which builds upon Clojure's rich set of <strong>persistent, immutable data structures</strong>. When mutability is needed, jank offers a software transaction memory and reactive Agent system to ensure <strong>clean and correct multi-threaded designs</strong>.</div><p><p><div class="has-text-centered"><a class="button mt-6 ml-4"href="/progress"><span class="icon"><i class="gg-list"></i></span><strong>Current progress</strong></a><a class="button mt-6 ml-4"href="https://github.com/jeaye/jank"><span class="icon"><i class="gg-git-fork"></i></span><strong>Github</strong></a><a class="button mt-6 ml-4"href="https://github.com/sponsors/jeaye"><span class="icon"><i class="gg-heart"></i></span><strong>Sponsor</strong></a></div></div></div></div></div></section><section class="section"id="how-it-works"><div class="container has-text-centered"><div class="section-header mb-6"><h2 class="title">Wide spectrum dynamics</h2><h3 class="subtitle">Enjoy both dynamic typing and static typing gradually. Enjoy both REPL iteration with JIT compilation and static AOT compilation to native executables.</h3></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">01</span><h3 class="title">Iterate like you would with Clojure</h3><p class="has-text-left">As you iterate in the REPL and figure out your data shapes, static typing will not be in your way.</div><div class="column is-6"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> unqualify</span></span>
<span class="line"><span style="color:#f8f8f2">  </span><span style="color:#e6db74">&quot;Strip the namespace from a keyword.&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">  [kw]</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#a6e22e">-&gt;</span><span style="color:#f8f8f2"> kw name keyword))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">02</span><h3 class="title">Add type annotations to lock down data shapes</h3><p class="has-text-left">Rather than using spec or malli to define your contracts, use jank's malli-like type definitions and then gain static type checking for any direct or indirect uses of that data.</div><div class="column is-6"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> unqualify</span></span>
<span class="line"><span style="color:#f8f8f2">  </span><span style="color:#e6db74">&quot;Strip the namespace from a keyword.&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">  [kw]</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#a6e22e">-&gt;</span><span style="color:#f8f8f2"> kw name keyword))</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">type</span><span style="color:#f8f8f2"> unqualify [:fn [:keyword] :unqualified-keyword])</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><span class="is-size-1">03</span><h3 class="title">Compile to machine code</h3><p class="has-text-left">jank is built on an LLVM-based JIT. With AOT enabled, both statically and dynamically linked executables can be generated. The jank compiler itself has very speedy start times and low memory usage.</div><div class="column is-6"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">$ </span><span style="color:#f92672">time</span><span style="color:#f8f8f2"> jank hello-world.clj</span></span>
<span class="line"><span style="color:#f8f8f2">hello world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">real  0m0.101s</span></span>
<span class="line"><span style="color:#f8f8f2">user  0m0.058s</span></span>
<span class="line"><span style="color:#f8f8f2">sys   0m0.035s</span></span>
<span class="line"></span></code></pre></div><div class="has-text-left mt-4"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">$ </span><span style="color:#f92672">time</span><span style="color:#f8f8f2"> clj hello-world.clj</span></span>
<span class="line"><span style="color:#f8f8f2">hello world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">real  0m0.703s</span></span>
<span class="line"><span style="color:#f8f8f2">user  0m1.957s</span></span>
<span class="line"><span style="color:#f8f8f2">sys   0m0.109s</span></span>
<span class="line"></span></code></pre></div></div></div></div></section><section class="section has-background-primary has-text-white"id="features"><div class="container"><div class="section-header has-text-centered mb-6"><h2 class="title has-text-white">jank builds upon Clojure.</h2><h3 class="subtitle has-text-white">Keep your existing code; gain more confidence and more speed.</h3></div><div class="columns is-centered"><div class="column is-9"><div class="columns"><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-bulb"></i></span><h3 class="title is-4 has-text-white">100% compatible with Clojure</h3></div><p>Any Clojure library without interop will compile into your jank projects.</div><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-sync"></i></span><h3 class="title is-4 has-text-white">REPL and native JIT</h3></div><p>Use your favority nrepl editor plugin. jank uses an LLVM-based JIT to compile machine code on the fly.</div></div><div class="columns"><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-list"></i></span><h3 class="title is-4 has-text-white">Be gradual</h3></div><p>Add types where you want them or disable static typing altogether. Generate dynamic binaries or static binaries, both using AOT compilation. Your choice.</div><div class="column is-6"><div class="icon-text mb-4"><span class="icon"><i class="gg-link"></i></span><h3 class="title is-4 has-text-white">Tooling friendly</h3></div><p>Leiningen, LSP, nREPL planned from the start. jank's compiler is also written with tooling in mind, so it can be used for lexing, parsing, and analysis.</div></div></div></div></div></section><section class="section"id="examples"><div class="container has-text-centered"><div class="section-header mb-6"><h2 class="title">jank examples</h2><h3 class="subtitle">All of the following examples are valid also Clojure code.</h3></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Generate a movie index</h3><p class="has-text-left"><div class="has-text-left"style="line-height:1.7em"><p>jank has very powerful capabilities for representing and transforming arbitrary data. Here, idiomatic usages of <code>reduce</code>, <code>zipmap</code>, <code>repeat</code>, and <code>merge-with</code> help create an index from genre to movie id with ease. No lenses are required for working with nested data.</div><p></div><div class="column is-8"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">def</span><span style="color:#f8f8f2"> movies {:the-weather-man {:title </span><span style="color:#e6db74">&quot;The Weather Man&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">                               :genres [:drama :comedy]</span></span>
<span class="line"><span style="color:#f8f8f2">                               :tomatometer </span><span style="color:#ae81ff">59</span><span style="color:#f8f8f2">}</span></span>
<span class="line"><span style="color:#f8f8f2">             :nightcrawler {:title </span><span style="color:#e6db74">&quot;Nightcrawler&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">                            :genres [:drama :crime :thriller]</span></span>
<span class="line"><span style="color:#f8f8f2">                            :tomatometer </span><span style="color:#ae81ff">95</span><span style="color:#f8f8f2">}</span></span>
<span class="line"><span style="color:#f8f8f2">             :the-bourne-identity {:title </span><span style="color:#e6db74">&quot;The Bourne Identity&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">                                   :genres [:action :thriller]</span></span>
<span class="line"><span style="color:#f8f8f2">                                   :tomatometer </span><span style="color:#ae81ff">84</span><span style="color:#f8f8f2">}})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">def</span><span style="color:#f8f8f2"> genre-&gt;movie (</span><span style="color:#a6e22e">reduce</span><span style="color:#f8f8f2"> (</span><span style="color:#f92672">fn</span><span style="color:#f8f8f2"> [acc [id movie]]</span></span>
<span class="line"><span style="color:#f8f8f2">                            (</span><span style="color:#f92672">let</span><span style="color:#f8f8f2"> [{:keys [genres]} movie</span></span>
<span class="line"><span style="color:#f8f8f2">                                  genre-&gt;this-movie (</span><span style="color:#a6e22e">zipmap</span><span style="color:#f8f8f2"> genres (</span><span style="color:#a6e22e">repeat</span><span style="color:#f8f8f2"> [id]))]</span></span>
<span class="line"><span style="color:#f8f8f2">                              (</span><span style="color:#a6e22e">merge-with</span><span style="color:#f8f8f2"> into acc genre-&gt;this-movie)))</span></span>
<span class="line"><span style="color:#f8f8f2">                          {}</span></span>
<span class="line"><span style="color:#f8f8f2">                          movies))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; genre-&gt;movie is now a useful index.</span></span>
<span class="line"><span style="color:#88846f">; =&gt;</span></span>
<span class="line"><span style="color:#f8f8f2">{:drama [:the-weather-man :nightcrawler],</span></span>
<span class="line"><span style="color:#f8f8f2"> :comedy [:the-weather-man],</span></span>
<span class="line"><span style="color:#f8f8f2"> :crime [:nightcrawler],</span></span>
<span class="line"><span style="color:#f8f8f2"> :thriller [:nightcrawler],</span></span>
<span class="line"><span style="color:#f8f8f2"> :action [:the-bourne-identity]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; We can look up all movies by genre.</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">-&gt;&gt;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">genre-&gt;movie</span><span style="color:#f8f8f2"> :thriller)</span></span>
<span class="line"><span style="color:#f8f8f2">     (</span><span style="color:#a6e22e">map</span><span style="color:#f8f8f2"> movies)</span></span>
<span class="line"><span style="color:#f8f8f2">     (</span><span style="color:#a6e22e">sort-by</span><span style="color:#f8f8f2"> :tomatometer))</span></span>
<span class="line"><span style="color:#88846f">; =&gt;</span></span>
<span class="line"><span style="color:#f8f8f2">({:title </span><span style="color:#e6db74">&quot;The Bourne Identity&quot;</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#f8f8f2">  :genres [:action :thriller],</span></span>
<span class="line"><span style="color:#f8f8f2">  :tomatometer </span><span style="color:#ae81ff">84</span><span style="color:#f8f8f2">}</span></span>
<span class="line"><span style="color:#f8f8f2"> {:title </span><span style="color:#e6db74">&quot;Nightcrawler&quot;</span><span style="color:#f8f8f2">,</span></span>
<span class="line"><span style="color:#f8f8f2">  :genres [:drama :crime :thriller],</span></span>
<span class="line"><span style="color:#f8f8f2">  :tomatometer </span><span style="color:#ae81ff">95</span><span style="color:#f8f8f2">})</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Convert bytes to human readable format</h3><p class="has-text-left"><div class="has-text-left"style="line-height:1.7em"><p>Beyond the traditional <code>map</code>, <code>filter</code>, and <code>reduce</code>, jank provides a powerful <code>loop</code> macro for more imperative-style loops while still being purely functional. Each meow <code>loop</code> has one or more corresponding <code>recur</code> usages which must be in tail position.</div><p></div><div class="column is-8"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> size-&gt;human-readable</span></span>
<span class="line"><span style="color:#f8f8f2">  </span><span style="color:#e6db74">&quot;Converts a size, in bytes, to a human readable format, such as 0 B, 1.5 kB,</span></span>
<span class="line"><span style="color:#e6db74">   10 GB, etc.&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">  [size-in-bytes]</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#f92672">if</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">and</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">&lt;</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">-1000</span><span style="color:#f8f8f2"> size-in-bytes) (</span><span style="color:#a6e22e">&lt;</span><span style="color:#f8f8f2"> size-in-bytes </span><span style="color:#ae81ff">1000</span><span style="color:#f8f8f2">))</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#a6e22e">str</span><span style="color:#f8f8f2"> size-in-bytes </span><span style="color:#e6db74">&quot; B&quot;</span><span style="color:#f8f8f2">)</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#f92672">let</span><span style="color:#f8f8f2"> [res (</span><span style="color:#f92672">loop</span><span style="color:#f8f8f2"> [acc size-in-bytes</span></span>
<span class="line"><span style="color:#f8f8f2">                     suffixes </span><span style="color:#e6db74">&quot;kMGTPE&quot;</span><span style="color:#f8f8f2">]</span></span>
<span class="line"><span style="color:#f8f8f2">                (</span><span style="color:#f92672">if-not</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">or</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#f8f8f2"> acc </span><span style="color:#ae81ff">-999950</span><span style="color:#f8f8f2">) (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">999950</span><span style="color:#f8f8f2"> acc))</span></span>
<span class="line"><span style="color:#f8f8f2">                  {:size acc</span></span>
<span class="line"><span style="color:#f8f8f2">                   :suffix (</span><span style="color:#a6e22e">first</span><span style="color:#f8f8f2"> suffixes)}</span></span>
<span class="line"><span style="color:#f8f8f2">                  (</span><span style="color:#f92672">recur</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">/</span><span style="color:#f8f8f2"> acc </span><span style="color:#ae81ff">1000</span><span style="color:#f8f8f2">) (</span><span style="color:#a6e22e">drop</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">1</span><span style="color:#f8f8f2"> suffixes))))]</span></span>
<span class="line"><span style="color:#f8f8f2">      (</span><span style="color:#a6e22e">format</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;%.1f %cB&quot;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">float</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">/</span><span style="color:#f8f8f2"> (:size res) </span><span style="color:#ae81ff">1000</span><span style="color:#f8f8f2">)) (:suffix res)))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">assert</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">=</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;0 B&quot;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">size-&gt;human-readable</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">0</span><span style="color:#f8f8f2">)))</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">assert</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">=</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;57.0 kB&quot;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">size-&gt;human-readable</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">*</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">57</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">1000</span><span style="color:#f8f8f2">))))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Truncate a string to a max length</h3><p class="has-text-left"><div class="has-text-left"style="line-height:1.7em"><p>jank's strings, as well as most of its other data structures, are immutable. However, jank provides such powerful tools for working with data that mutability is very rarely a concern.</div><p></div><div class="column is-8"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">def</span><span style="color:#f8f8f2"> max-text-length </span><span style="color:#ae81ff">256</span><span style="color:#f8f8f2">)</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> truncate</span></span>
<span class="line"><span style="color:#f8f8f2">  </span><span style="color:#e6db74">&quot;Truncates the text to be no longer than the max length.&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">  [text max-length]</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#f92672">cond</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#f8f8f2"> max-length </span><span style="color:#ae81ff">0</span><span style="color:#f8f8f2">)</span></span>
<span class="line"><span style="color:#f8f8f2">    </span><span style="color:#e6db74">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#a6e22e">&lt;=</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">count</span><span style="color:#f8f8f2"> text) max-length)</span></span>
<span class="line"><span style="color:#f8f8f2">    text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">    :else</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#a6e22e">str</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">subs</span><span style="color:#f8f8f2"> text </span><span style="color:#ae81ff">0</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">dec</span><span style="color:#f8f8f2"> max-length)) </span><span style="color:#e6db74">&quot;…&quot;</span><span style="color:#f8f8f2">)))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">assert</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">=</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;&quot;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">truncate</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;wowzer&quot;</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">0</span><span style="color:#f8f8f2">)))</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#a6e22e">assert</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">=</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;wow…&quot;</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">truncate</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;wowzer&quot;</span><span style="color:#f8f8f2"> </span><span style="color:#ae81ff">4</span><span style="color:#f8f8f2">)))</span></span>
<span class="line"></span></code></pre></div></div></div><div class="columns is-vcentered"><div class="column is-6"><h3 class="title">Redefine any var</h3><p class="has-text-left"><div class="has-text-left"style="line-height:1.7em"><p>Every <code>def</code> or <code>defn</code> exists within a var, which is a stable, namespace-level container for values. Vars can be redefined to contain different values. <code>with-redefs</code> redefines a var within its body's scope, which is very useful for removing side effects from test cases or forcing functions to return specific values.</div><p></div><div class="column is-8"><div class="has-text-left"><pre class="shiki"style="background-color:#272822"><code><span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> post! [_request]</span></span>
<span class="line"><span style="color:#f8f8f2">  </span><span style="color:#88846f">; Assuming this performs some network effect.</span></span>
<span class="line"><span style="color:#f8f8f2">  {:status </span><span style="color:#ae81ff">200</span></span>
<span class="line"><span style="color:#f8f8f2">   :body (</span><span style="color:#a6e22e">pr-str</span><span style="color:#f8f8f2"> {:order </span><span style="color:#ae81ff">7821</span><span style="color:#f8f8f2">})})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">defn</span><span style="color:#f8f8f2"> submit-order! []</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#f92672">let</span><span style="color:#f8f8f2"> [request {:url </span><span style="color:#e6db74">&quot;/submit-order&quot;</span><span style="color:#f8f8f2">}</span></span>
<span class="line"><span style="color:#f8f8f2">        order (</span><span style="color:#a6e22e">post!</span><span style="color:#f8f8f2"> request)</span></span>
<span class="line"><span style="color:#f8f8f2">        order-body (</span><span style="color:#a6e22e">-&gt;</span><span style="color:#f8f8f2"> order :body read-string)]</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#f92672">if</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">contains?</span><span style="color:#f8f8f2"> order-body :error)</span></span>
<span class="line"><span style="color:#f8f8f2">      </span><span style="color:#88846f">; This is the code path we want to test.</span></span>
<span class="line"><span style="color:#f8f8f2">      {:error </span><span style="color:#e6db74">&quot;failed to submit&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">       :request request</span></span>
<span class="line"><span style="color:#f8f8f2">       :response order-body}</span></span>
<span class="line"><span style="color:#f8f8f2">      (:order order-body))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846f">; Later on, in tests, skip the side effect by redefining.</span></span>
<span class="line"><span style="color:#f8f8f2">(</span><span style="color:#f92672">deftest</span><span style="color:#f8f8f2"> submit-order</span></span>
<span class="line"><span style="color:#f8f8f2">  (</span><span style="color:#a6e22e">testing</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;failed post&quot;</span></span>
<span class="line"><span style="color:#f8f8f2">    (</span><span style="color:#a6e22e">with-redefs</span><span style="color:#f8f8f2"> [post! (</span><span style="color:#f92672">fn</span><span style="color:#f8f8f2"> [_]</span></span>
<span class="line"><span style="color:#f8f8f2">                          </span><span style="color:#88846f">; Fake error to see how the rest of the code handles it.</span></span>
<span class="line"><span style="color:#f8f8f2">                          {:status </span><span style="color:#ae81ff">500</span></span>
<span class="line"><span style="color:#f8f8f2">                           :body (</span><span style="color:#a6e22e">pr-str</span><span style="color:#f8f8f2"> {:error </span><span style="color:#e6db74">&quot;uh oh&quot;</span><span style="color:#f8f8f2">})})]</span></span>
<span class="line"><span style="color:#f8f8f2">      (</span><span style="color:#a6e22e">is</span><span style="color:#f8f8f2"> (</span><span style="color:#a6e22e">=</span><span style="color:#f8f8f2"> </span><span style="color:#e6db74">&quot;failed to submit&quot;</span><span style="color:#f8f8f2"> (:error (</span><span style="color:#a6e22e">submit-order!</span><span style="color:#f8f8f2">)))))))</span></span>
<span class="line"></span></code></pre></div></div></div></div></section></div><footer class="footer"><div class="container"><div class="columns has-text-centered"><div class="column has-text-centered"><aside class="menu"><p class="menu-label">Resources<ul class="menu-list"><li><a href="https://clojurians.slack.com/archives/C03SRH97FDK">Community</a><li><a href="https://github.com/jeaye/jank">Github</a></ul></aside></div></div><div class="container has-text-centered"><div class="content is-small"><p>© 2022 Jeaye Wilkerson | All rights reserved.</div></div></div></footer>