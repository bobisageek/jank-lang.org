#!/usr/bin/env bash

set -xeuo pipefail

git checkout gh-pages
git clean -fd -e /build

# TODO: Remove everything there except build and .git
for file in build/*;
do
  rm -rf "${file##build/}"
  mv "${file}" .
done
rmdir build

git add .
git commit -m "Automated publish"

# Pushing from CI requires an access token.
if [[ "${GITHUB_ACCESS_TOKEN}x" != "x" ]];
then
  git remote remove ci-origin || true
  git remote add ci-origin "https://${GITHUB_ACCESS_TOKEN}@github.com/jeaye/jank-lang.org.git"
  git push ci-origin gh-pages
else
  git push origin gh-pages
fi

git checkout -
